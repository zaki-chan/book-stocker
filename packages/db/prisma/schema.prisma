// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ユーザーテーブルの定義
model User {
  id  Int   @id@default(autoincrement()) //ユーザーID
  email String @unique //メールアドレス
  username  String //ユーザー名

  // Userを参照している中間テーブル
  records Record[]
  wishList  WishList[]
}
// 書籍テーブルの定義
// Google Books APIを利用して書籍テーブルに追加
model Book {
  id  Int   @id @default(autoincrement()) //書籍ID
  isbn  String  @unique //ISBNコード
  title   String //本のタイトル,
  author  String //著者
  publisher String //出版社
  coverUrl  String? //表紙画像URL

  // Bookを参照している中間テーブル
  records Record[]
  wishListedBy  WishList[]
}
// 記録テーブルの定義
model Record{
  id  Int @id @default(autoincrement()) //記録データのID
  userId  Int //記録したユーザーのID
  bookId  Int //記録されている書籍ID
  rating  Int @default(0)  //評価スコア 0~5
  memo    String //読んだ本に関するメモ
  isPublic  Boolean @default(false) //記録の公開状態

  //RecordはUserとBookの中間テーブルであるため参照しているテーブルと対応するキーを指定
  user  User  @relation(fields: [userId], references:[id])
  book  Book  @relation(fields: [bookId], references:[id])

  tags  RecordTag[]
}
// 読みたい本のテーブルの定義
model WishList{
  userId  Int //ユーザID
  bookId  Int //書籍ID

  //WishListはUserとBookの中間テーブルであるため参照しているテーブルと対応するキーを指定
  user User @relation(fields: [userId], references:[id])
  book Book @relation(fields: [bookId], references:[id])

  // 複合主キー
  @@id([userId, bookId])
}
// 記録に付与するタグを管理するテーブルの定義
model Tag{
  id  Int   @id @default(autoincrement()) //タグID
  name  String  @unique //タグ名

  // Tagを参照している中間テーブル
  records RecordTag[]
}
// 記録についたタグを管理するテーブルの定義
model RecordTag{
  recordId  Int // 記録ID
  tagId     Int // タグID

  // RecordTagはRecordとTagの中間テーブルであるため参照しているテーブルと対応するキーを指定
  record  Record  @relation(fields: [recordId], references: [id])
  tag   Tag   @relation(fields:[tagId], references: [id])

  // 複合主キー
  @@id([recordId, tagId])
}